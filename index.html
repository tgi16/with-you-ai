<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>With You Studio - Sales Master AI v3.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body { font-family: 'Padauk', sans-serif; }
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    
    .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .nav-item.active, .mobile-nav-item.active {
        background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        border-color: transparent;
    }

    /* Sales Tactic Active State */
    .tactic-btn.active {
        background-color: #7e22ce; 
        border-color: #a855f7;
        color: white;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.4);
    }

    /* Mobile Sidebar Transition */
    #sidebar { transition: transform 0.3s ease-in-out; }
    .sidebar-open { transform: translateX(0) !important; }
    .sidebar-closed { transform: translateX(-100%); }
    @media (min-width: 768px) { .sidebar-closed { transform: translateX(0); } }

    /* Hide scrollbar for tab container */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Listening Animation */
    .listening-ring {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        animation: pulse-red 1.5s infinite cubic-bezier(0.66, 0, 0, 1);
        border-color: #ef4444 !important; color: #ef4444 !important;
    }
    @keyframes pulse-red { to { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }
  </style>
</head>
<body class="bg-slate-950 text-slate-200 h-screen h-[100dvh] flex overflow-hidden">

  <!-- OVERLAY for Mobile -->
  <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden glass-panel"></div>

  <!-- SIDEBAR NAVIGATION (Desktop Left) -->
  <aside id="sidebar" class="sidebar-closed fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 border-r border-slate-800 flex flex-col transition-transform duration-300 md:relative md:translate-x-0 shadow-2xl">
    
    <!-- Logo Area -->
    <div class="p-6 border-b border-slate-800 flex items-center justify-between">
        <div>
            <h1 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                <i class="ph ph-camera text-blue-400"></i> With You
            </h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest mt-1">AI Sales Manager</p>
        </div>
        <button onclick="toggleSidebar()" class="md:hidden text-slate-400"><i class="ph ph-x text-xl"></i></button>
    </div>

    <!-- Menu Items -->
    <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-6">
        
        <!-- Group 1: Priority -->
        <div>
            <p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Priority</p>
            <div class="space-y-1">
                <button onclick="loadView('dm')" id="nav-dm" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-chat-circle-text text-lg text-purple-400"></i> DM Sales Master
                </button>
                <button onclick="loadView('brand')" id="nav-brand" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-brain text-lg text-yellow-400"></i> Brand Brain
                </button>
            </div>
        </div>

        <!-- Group 2: Content -->
        <div>
            <p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Content Marketing</p>
            <div class="space-y-1">
                <button onclick="loadView('fbpost')" id="nav-fbpost" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-facebook-logo text-lg"></i> Facebook Post
                </button>
                <button onclick="loadView('tiktok')" id="nav-tiktok" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-tiktok-logo text-lg"></i> TikTok Script
                </button>
            </div>
        </div>

        <!-- Group 3: Operation -->
        <div>
            <p class="px-3 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2">Studio Ops</p>
            <div class="space-y-1">
                <button onclick="loadView('timeline')" id="nav-timeline" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-clock text-lg"></i> Timeline
                </button>
                <button onclick="loadView('pose')" id="nav-pose" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-person-simple-walk text-lg"></i> Pose Helper
                </button>
            </div>
        </div>

        <!-- Group 4: Archive -->
        <div>
            <div class="space-y-1 border-t border-slate-800 pt-4">
                <button onclick="loadView('history')" id="nav-history" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition">
                    <i class="ph ph-calendar-check text-lg"></i> Saved History
                </button>
            </div>
        </div>

    </nav>

    <!-- Footer -->
    <div class="p-4 border-t border-slate-800 text-xs text-slate-600 text-center">
        <span class="inline-block px-2 py-1 rounded bg-slate-800 border border-slate-700 text-purple-400 font-mono">v3.0 (Sales Master)</span>
    </div>
  </aside>


  <!-- MAIN CONTENT AREA (RIGHT) -->
  <div class="flex-1 flex flex-col h-full relative w-full">
    
    <!-- Mobile Header -->
    <header class="md:hidden h-14 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-4 z-30 shrink-0">
        <button onclick="toggleSidebar()" class="text-white p-2"><i class="ph ph-list text-2xl"></i></button>
        <span class="font-bold text-blue-400 text-lg">With You Studio</span>
        <div class="w-8"></div>
    </header>

    <!-- MOBILE QUICK NAV (Horizontal Scroll) -->
    <div class="md:hidden bg-slate-900/90 border-b border-slate-800 overflow-x-auto no-scrollbar py-2 px-3 flex gap-2 shrink-0 backdrop-blur-sm z-20 sticky top-0">
        <button onclick="loadView('dm')" id="mob-dm" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-chat-circle-text text-purple-400"></i> DM Sales
        </button>
        <button onclick="loadView('fbpost')" id="mob-fbpost" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-facebook-logo"></i> Post
        </button>
        <button onclick="loadView('tiktok')" id="mob-tiktok" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-tiktok-logo"></i> TikTok
        </button>
        <button onclick="loadView('brand')" id="mob-brand" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-brain"></i> Brain
        </button>
        <button onclick="loadView('timeline')" id="mob-timeline" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-clock"></i> Timeline
        </button>
        <button onclick="loadView('pose')" id="mob-pose" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-camera"></i> Pose
        </button>
        <button onclick="loadView('history')" id="mob-history" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-800">
            <i class="ph ph-calendar"></i> History
        </button>
    </div>

    <!-- Dynamic Content Container -->
    <div id="content-container" class="flex-1 overflow-y-auto p-4 md:p-8 max-w-4xl mx-auto w-full pb-20 scroll-smooth">
        <!-- Content injects here via JS -->
    </div>

  </div>

  <!-- TOAST NOTIFICATION -->
  <div id="toast" class="toast">Action Complete</div>


  <!-- TEMPLATES -->
  
  <!-- 1. DM SALES MASTER TEMPLATE (MAJOR UPGRADE) -->
  <template id="tpl-dm">
    <div class="animate-fade-in space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-xl md:text-2xl font-bold text-purple-400 flex items-center gap-2"><i class="ph ph-chat-circle-text"></i> DM Sales Master</h2>
            <div class="text-[10px] text-slate-400 bg-slate-800 px-2 py-1 rounded">v3.0</div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column: Strategy & Input -->
            <div class="space-y-4">
                <div class="glass-panel p-4 md:p-5 rounded-xl space-y-4 border border-purple-500/20 shadow-lg shadow-purple-900/10">
                    
                    <!-- Context Section -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Topic</label>
                            <select id="dmService" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 text-sm text-white focus:border-purple-500">
                                <option value="Pre-wedding Package">üíç Pre-wedding</option>
                                <option value="Wedding Actual Day">üë∞ Wedding Day</option>
                                <option value="Family Photoshoot">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</option>
                                <option value="Graduation Photo">üéì Graduation</option>
                                <option value="General Inquiry">‚ùì General</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Status</label>
                            <select id="dmScenario" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-2.5 text-sm text-white focus:border-purple-500">
                                <option value="New Inquiry">New Inquiry</option>
                                <option value="Price Objection">Expensive (·Äà·Ä±·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏)</option>
                                <option value="Ghosting">Seen (·ÄÖ·Ä¨·Äô·Äï·Äº·Äî·Ä∫)</option>
                                <option value="Comparing">Comparing (·Äö·Äæ·Äâ·Ä∫·Äî·Ä±)</option>
                                <option value="Closing">Ready to Book</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Message Input -->
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Client Message / Context</label>
                        <div class="relative">
                            <textarea id="dmInput" placeholder="Client ·Äô·Ä±·Ä∏·Äê·Ä≤·Ä∑·ÄÖ·Ä¨ (·Äû·Ä≠·ÄØ·Ä∑) ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä±..." class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm h-24 text-white resize-none focus:border-purple-500 pr-10 shadow-inner"></textarea>
                            <button onclick="startVoiceInput('dmInput', this)" class="absolute right-2 bottom-2 bg-slate-700/80 hover:bg-purple-600 p-2 rounded-full transition text-slate-300 hover:text-white" title="Speak">
                                <i class="ph ph-microphone text-lg"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- POWER TOOLS (TACTICS) -->
                    <div>
                        <label class="block text-xs font-bold text-purple-300 uppercase mb-2 flex items-center gap-1"><i class="ph ph-lightning"></i> Sales Power Tools (Strategy)</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="setDmType('Value First', this)" class="tactic-btn p-2 border border-slate-600 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-left transition flex items-center gap-2">
                                <i class="ph ph-diamond text-blue-400"></i> Value Stack<br><span class="text-[9px] opacity-50 block">Highlight Benefits</span>
                            </button>
                            <button onclick="setDmType('Price Defense', this)" class="tactic-btn p-2 border border-slate-600 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-left transition flex items-center gap-2">
                                <i class="ph ph-shield-check text-green-400"></i> Price Defense<br><span class="text-[9px] opacity-50 block">It's worth it</span>
                            </button>
                            <button onclick="setDmType('Urgency', this)" class="tactic-btn p-2 border border-slate-600 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-left transition flex items-center gap-2">
                                <i class="ph ph-timer text-orange-400"></i> Create Urgency<br><span class="text-[9px] opacity-50 block">Limited Slots</span>
                            </button>
                            <button onclick="setDmType('Soft Close', this)" class="tactic-btn active p-2 border border-slate-600 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-left transition flex items-center gap-2">
                                <i class="ph ph-handshake text-purple-400"></i> Soft Close<br><span class="text-[9px] opacity-50 block">Guidance</span>
                            </button>
                        </div>
                        <input type="hidden" id="dmType" value="Soft Close">
                    </div>

                    <button onclick="generateAI('dm_best')" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-purple-900/40 transition active:scale-95 flex items-center justify-center gap-2">
                        <i class="ph ph-magic-wand text-lg"></i> Generate Sales Replies
                    </button>
                </div>
            </div>

            <!-- Right Column: Output -->
            <div id="dmResultArea" class="hidden h-full">
                <div class="glass-panel p-4 md:p-6 rounded-xl border-purple-500/30 h-full flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10"><i class="ph ph-robot text-6xl text-purple-500"></i></div>
                    
                    <div class="flex justify-between items-center mb-3 z-10">
                        <span class="text-xs font-bold text-purple-400 uppercase flex items-center gap-1"><i class="ph ph-check-circle"></i> Suggested Options</span>
                        <div class="flex gap-2">
                            <button onclick="saveResult('DM Reply', 'dmOutput')" class="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded text-white border border-slate-600">Save</button>
                            <button onclick="copyText('dmOutput')" class="text-xs bg-purple-900/50 hover:bg-purple-800 px-3 py-1.5 rounded text-purple-200 border border-purple-700">Copy All</button>
                        </div>
                    </div>
                    
                    <div id="dmOutput" class="whitespace-pre-wrap text-sm text-slate-200 leading-relaxed flex-1 overflow-y-auto max-h-[600px] z-10 pr-2 custom-scroll"></div>
                </div>
            </div>
        </div>
    </div>
  </template>

  <!-- 2. BRAND BRAIN TEMPLATE (UPDATED with Package Info) -->
  <template id="tpl-brand">
    <div class="animate-fade-in max-w-2xl mx-auto space-y-6">
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 md:p-8 rounded-2xl border border-slate-700 relative overflow-hidden shadow-2xl">
            <i class="ph ph-brain absolute top-4 right-4 text-8xl text-slate-700 opacity-20"></i>
            <h2 class="text-xl md:text-2xl font-bold text-white mb-2 flex items-center gap-2"><i class="ph ph-database"></i> Studio Brain</h2>
            <p class="text-sm text-slate-400 mb-6">Teach AI about your business once, and it will sell for you forever.</p>
            
            <div class="space-y-6 text-left relative z-10">
                
                <!-- Packages Section (NEW) -->
                <div class="bg-slate-950/50 p-4 rounded-xl border border-slate-700">
                    <label class="text-xs font-bold text-yellow-400 uppercase mb-2 block flex items-center gap-1"><i class="ph ph-package"></i> Packages & Pricing (Important)</label>
                    <textarea id="brandPackages" placeholder="Example:
- Silver Package: 3 Lakhs (1 Location, 2 Dresses, 20 Photos)
- Gold Package: 5 Lakhs (2 Locations, 4 Dresses, 40 Photos, Free Frame)
- Diamond: 8 Lakhs (All inclusive)" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-sm text-white h-32 resize-none focus:border-yellow-500"></textarea>
                    <p class="text-[10px] text-slate-500 mt-1">* AI will use this to answer price questions accurately.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-blue-400 uppercase">Studio Vibe</label>
                        <input type="text" id="brandStyle" value="Moody, Cinematic, Emotional" class="w-full mt-1 bg-slate-950 border border-slate-700 rounded p-3 text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-blue-400 uppercase">Target Audience</label>
                        <input type="text" id="brandClient" value="Luxury Couples, Young Professionals" class="w-full mt-1 bg-slate-950 border border-slate-700 rounded p-3 text-white">
                    </div>
                </div>
                
                <!-- Contact Info -->
                <div>
                    <label class="text-xs font-bold text-slate-300 uppercase mb-2 block">Contact Details (Auto CTA)</label>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="brandPhone" placeholder="Phone (09...)" class="bg-slate-950 border border-slate-700 rounded p-2 text-sm text-white">
                        <input type="text" id="brandViber" placeholder="Viber No." class="bg-slate-950 border border-slate-700 rounded p-2 text-sm text-white">
                        <input type="text" id="brandFB" placeholder="Facebook Link" class="bg-slate-950 border border-slate-700 rounded p-2 text-sm text-white">
                        <input type="text" id="brandAddr" placeholder="Address (Taunggyi)" class="bg-slate-950 border border-slate-700 rounded p-2 text-sm text-white">
                    </div>
                </div>

                <div class="pt-2">
                    <div class="flex items-center gap-2 text-green-400 text-xs justify-center bg-green-900/20 py-3 rounded border border-green-900/30">
                        <i class="ph ph-check-circle-fill"></i> Changes Auto-Saved to AI Brain.
                    </div>
                </div>
            </div>
        </div>
    </div>
  </template>

  <!-- 3. FACEBOOK POST TEMPLATE -->
  <template id="tpl-fbpost">
    <div class="animate-fade-in space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-xl md:text-2xl font-bold text-white flex items-center gap-2"><i class="ph ph-facebook-logo text-blue-500"></i> Facebook Post</h2>
            <span class="bg-blue-900/30 text-blue-400 text-[10px] md:text-xs px-2 py-1 rounded border border-blue-500/30">3 Options</span>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-4">
                <div class="glass-panel p-4 md:p-5 rounded-xl space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Topic</label>
                        <div class="flex gap-2">
                            <input type="text" id="fbInput" placeholder="·Ä•·Äï·Äô·Ä¨ - Pre-wedding package ·Ä°·Äû·ÄÖ·Ä∫..." class="flex-1 w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:border-blue-500 outline-none text-white">
                            <button onclick="startVoiceInput('fbInput', this)" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg px-4 flex items-center justify-center transition active:scale-95" title="Speak to Type">
                                <i class="ph ph-microphone text-xl text-blue-400"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Tone</label>
                            <select id="fbTone" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm outline-none text-white">
                                <option>Professional & Warm</option>
                                <option>Friendly & Exciting</option>
                                <option>Emotional & Touching</option>
                                <option>Casual & Fun</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Length</label>
                            <select id="fbLength" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm outline-none text-white">
                                <option value="Medium">Medium (Standard)</option>
                                <option value="Long">Long (Storytelling)</option>
                                <option value="Short">Short (Caption)</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="generateAI('fbpost')" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-blue-600/30 transition flex justify-center items-center gap-2 active:scale-95">
                        <i class="ph ph-pen-nib"></i> Write Post (3 Options)
                    </button>
                </div>

                <div id="fbResultArea" class="hidden space-y-2">
                    <div class="glass-panel p-4 md:p-6 rounded-xl border-blue-500/30">
                        <div id="fbOutput" class="whitespace-pre-wrap leading-relaxed text-sm text-slate-200"></div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveResult('Facebook', 'fbOutput')" class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-lg text-xs font-bold border border-slate-700">üíæ Save</button>
                        <button onclick="copyText('fbOutput')" class="flex-1 bg-slate-800 hover:bg-slate-700 py-3 rounded-lg text-xs font-bold border border-slate-700">üìã Copy</button>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <div class="bg-slate-900 border border-slate-800 p-4 rounded-xl">
                    <h3 class="text-sm font-bold text-blue-300 mb-3 flex items-center gap-2"><i class="ph ph-sparkle"></i> Creative Assistant</h3>
                    <div class="space-y-2">
                        <button onclick="runAssistant('fb_ideas')" class="w-full text-left p-3 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-slate-300 border border-slate-700 transition">
                            üí° Get 5 Post Ideas
                        </button>
                        <button onclick="runAssistant('fb_hooks')" class="w-full text-left p-3 rounded-lg bg-slate-800 hover:bg-slate-700 text-xs text-slate-300 border border-slate-700 transition">
                            üé£ Generate Catchy Hooks
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </template>

  <!-- 4. TIMELINE TEMPLATE -->
  <template id="tpl-timeline">
    <div class="animate-fade-in space-y-6">
        <h2 class="text-xl md:text-2xl font-bold text-orange-400 flex items-center gap-2"><i class="ph ph-clock"></i> Timeline Generator</h2>
        <div class="glass-panel p-4 md:p-6 rounded-xl">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold">Start</label>
                    <select id="tlStart" class="w-full p-2 mt-1 bg-slate-800 rounded border border-slate-700 text-white"><option>6:00 AM</option><option>7:00 AM</option><option>8:00 AM</option><option>1:00 PM</option></select>
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold">Place</label>
                    <select id="tlPlace" class="w-full p-2 mt-1 bg-slate-800 rounded border border-slate-700 text-white"><option>Taunggyi (City)</option><option>Inle Lake</option><option>Kalaw</option><option>Kakku</option><option>Ayetharyar</option></select>
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold">Outfits</label>
                    <select id="tlDress" class="w-full p-2 mt-1 bg-slate-800 rounded border border-slate-700 text-white"><option>3 Dresses</option><option>4 Dresses</option><option>5 Dresses</option><option>2 Dresses (Mini)</option></select>
                </div>
                <div>
                    <label class="text-xs text-slate-400 uppercase font-bold">Pacing</label>
                    <select id="tlPace" class="w-full p-2 mt-1 bg-slate-800 rounded border border-slate-700 text-white"><option value="Relaxed">Relaxed (·Ä°·Ä±·Ä∏·ÄÜ·Ä±·Ä∏)</option><option value="Packed">Packed (·Äõ·Ä≠·ÄØ·ÄÄ·Ä∫·ÄÄ·ÄΩ·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·Äô·Äª·Ä¨·Ä∏)</option></select>
                </div>
            </div>
            <div class="flex items-center gap-2 mb-4 p-2 bg-slate-800/50 rounded">
                <input type="checkbox" id="tlSunset" class="w-4 h-4 rounded bg-slate-800 border-slate-700 text-orange-500">
                <label for="tlSunset" class="text-sm text-slate-300">Include Sunset Shot (·Äî·Ä±·Äù·ÄÑ·Ä∫·ÄÅ·Äª·Ä≠·Äî·Ä∫)</label>
            </div>
            <button onclick="generateAI('timeline')" class="w-full bg-orange-600 hover:bg-orange-500 py-3 rounded text-white font-bold active:scale-95 transition">Generate Schedule</button>
        </div>
        <div id="tlResultArea" class="hidden glass-panel p-4 md:p-6 rounded-xl">
            <div id="tlOutput" class="whitespace-pre-wrap text-sm text-slate-200 font-mono"></div>
            <div class="mt-4 flex gap-2">
                <button onclick="downloadFile('Schedule.txt', 'tlOutput')" class="text-xs text-blue-400 border border-blue-900 p-2 rounded flex items-center gap-1">‚¨áÔ∏è Download</button>
                <button onclick="copyText('tlOutput')" class="text-xs text-slate-400 border border-slate-700 p-2 rounded flex items-center gap-1">üìã Copy</button>
            </div>
        </div>
    </div>
  </template>

  <!-- 5. TIKTOK & POSE (HTML Strings in JS to save space) -->
  
  <!-- JAVASCRIPT LOGIC -->
  <script>
    let currentView = 'dm'; // Start with DM

    document.addEventListener('DOMContentLoaded', () => {
        loadView('dm'); // Prioritize DM on load
        // Restore Brand Data if exists
        setTimeout(loadBrandData, 500); 
    });

    // --- NAVIGATION & UI ---
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        if (sidebar.classList.contains('sidebar-closed')) {
            sidebar.classList.remove('sidebar-closed');
            sidebar.classList.add('sidebar-open');
            overlay.classList.remove('hidden');
        } else {
            sidebar.classList.add('sidebar-closed');
            sidebar.classList.remove('sidebar-open');
            overlay.classList.add('hidden');
        }
    }

    function loadView(viewId) {
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navBtn = document.getElementById('nav-' + viewId);
        if(navBtn) navBtn.classList.add('active');

        document.querySelectorAll('.mobile-nav-item').forEach(el => {
            el.classList.remove('active', 'border-blue-500', 'text-white');
            el.classList.add('border-slate-700', 'text-slate-300');
        });
        const mobBtn = document.getElementById('mob-' + viewId);
        if(mobBtn) {
            mobBtn.classList.add('active', 'border-blue-500', 'text-white');
            mobBtn.classList.remove('border-slate-700', 'text-slate-300');
            mobBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        if(window.innerWidth < 768) {
            document.getElementById('sidebar').classList.add('sidebar-closed');
            document.getElementById('sidebar').classList.remove('sidebar-open');
            document.getElementById('overlay').classList.add('hidden');
        }

        const container = document.getElementById('content-container');
        container.innerHTML = ''; 

        let templateId = 'tpl-' + viewId;
        
        if(viewId === 'tiktok') container.innerHTML = getTikTokHTML();
        else if(viewId === 'pose') container.innerHTML = getPoseHTML();
        else if(viewId === 'history') { container.innerHTML = getHistoryHTML(); renderHistoryList(); }
        else {
            const tpl = document.getElementById(templateId);
            if(tpl) {
                container.appendChild(tpl.content.cloneNode(true));
                if(viewId === 'brand') loadBrandData(); // Populate inputs
            }
        }
        currentView = viewId;
    }

    // --- HTML GENERATORS ---
    function getTikTokHTML() {
        return `<div class="animate-fade-in space-y-6"><h2 class="text-xl md:text-2xl font-bold text-teal-400 flex items-center gap-2"><i class="ph ph-tiktok-logo"></i> TikTok Script</h2><div class="glass-panel p-4 md:p-5 rounded-xl space-y-4"><div class="flex gap-2"><input type="text" id="ttInput" placeholder="Video Topic..." class="flex-1 bg-slate-800 border border-slate-700 rounded p-3 text-white"><button onclick="startVoiceInput('ttInput', this)" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded px-4 text-teal-400"><i class="ph ph-microphone text-xl"></i></button></div><select id="ttStyle" class="w-full bg-slate-800 border border-slate-700 rounded p-3 text-white"><option>Trending & Fast</option><option>Vlog / Behind Scenes</option><option>Cinematic Mood</option></select><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><button onclick="generateAI('tt_caption')" class="bg-slate-700 py-3 rounded text-white text-sm font-bold active:scale-95 transition">Get 3 Captions</button><button onclick="generateAI('tt_script')" class="bg-teal-600 py-3 rounded text-white text-sm font-bold active:scale-95 transition">Write 3 Scripts</button></div></div><div id="ttResultArea" class="hidden glass-panel p-4 md:p-6 rounded-xl"><div id="ttOutput" class="whitespace-pre-wrap text-sm text-slate-200"></div><button onclick="saveResult('TikTok', 'ttOutput')" class="mt-4 bg-slate-800 text-xs py-2 px-4 rounded border border-slate-700">üíæ Save</button></div></div>`;
    }
    function getPoseHTML() {
        return `<div class="animate-fade-in space-y-6"><h2 class="text-xl md:text-2xl font-bold text-pink-400 flex items-center gap-2"><i class="ph ph-camera"></i> Pose Helper</h2><div class="glass-panel p-4 md:p-5 rounded-xl space-y-4"><div class="grid grid-cols-1 sm:grid-cols-2 gap-3"><div><label class="text-xs font-bold text-slate-400 uppercase">Outfit</label><select id="poseOutfit" class="w-full mt-1 bg-slate-800 border border-slate-700 rounded p-2 text-white text-sm"><option>Wedding Gown/Suit</option><option>Traditional</option><option>Casual</option></select></div><div><label class="text-xs font-bold text-slate-400 uppercase">Props</label><input type="text" id="poseProps" placeholder="Flowers..." class="w-full mt-1 bg-slate-800 border border-slate-700 rounded p-2 text-white text-sm"></div></div><div class="flex gap-2 mb-2"><button onclick="fillPose('Shy')" class="px-3 py-1 bg-pink-900/30 text-pink-200 text-xs rounded border border-pink-500/30">üò≥ Shy</button><button onclick="fillPose('Plus')" class="px-3 py-1 bg-pink-900/30 text-pink-200 text-xs rounded border border-pink-500/30">‚ù§Ô∏è Plus</button></div><div class="relative"><textarea id="poseInput" class="w-full bg-slate-800 border border-slate-700 rounded p-3 text-white h-24 pr-10" placeholder="Situation..."></textarea><button onclick="startVoiceInput('poseInput', this)" class="absolute right-2 bottom-2 bg-slate-700/80 hover:bg-pink-600 p-2 rounded-full transition text-slate-300 hover:text-white"><i class="ph ph-microphone text-lg"></i></button></div><button onclick="generateAI('pose')" class="w-full bg-pink-600 py-3 rounded text-white font-bold active:scale-95 transition">Generate Poses</button></div><div id="poseResultArea" class="hidden glass-panel p-4 md:p-6 rounded-xl"><div id="poseOutput" class="whitespace-pre-wrap text-sm text-slate-200"></div></div></div>`;
    }
    function getHistoryHTML() {
        return `<div class="animate-fade-in space-y-6"><div class="flex justify-between items-center"><h2 class="text-xl md:text-2xl font-bold text-white"><i class="ph ph-clock-counter-clockwise"></i> History</h2><button onclick="clearHistory()" class="text-red-400 text-xs border border-red-900 px-3 py-1 rounded">Clear</button></div><div id="historyListContainer" class="space-y-4 pb-10"></div></div>`;
    }

    // --- BRAND DATA PERSISTENCE ---
    function saveBrandData() {
        const ids = ['brandStyle', 'brandClient', 'brandPhone', 'brandViber', 'brandFB', 'brandTT', 'brandAddr', 'brandPackages'];
        const data = {};
        ids.forEach(id => { 
            const el = document.getElementById(id);
            if(el) data[id] = el.value; 
        });
        localStorage.setItem('withYouBrandData', JSON.stringify(data));
        showToast("Brand Data Saved!");
    }

    function loadBrandData() {
        const data = JSON.parse(localStorage.getItem('withYouBrandData') || '{}');
        for (const [key, value] of Object.entries(data)) {
            const el = document.getElementById(key);
            if(el) el.value = value;
        }
        // Auto-save listener
        const inputs = document.querySelectorAll('#brand input, #brand textarea');
        inputs.forEach(input => input.addEventListener('change', saveBrandData));
    }

    // --- AI LOGIC (SALES MASTER ENGINE) ---
    async function generateAI(type) {
        const outputIds = { 'fbpost': 'fbOutput', 'dm_best': 'dmOutput', 'timeline': 'tlOutput', 'tt_caption': 'ttOutput', 'tt_script': 'ttOutput', 'pose': 'poseOutput' };
        const areaIds = { 'fbpost': 'fbResultArea', 'dm_best': 'dmResultArea', 'timeline': 'tlResultArea', 'tt_caption': 'ttResultArea', 'tt_script': 'ttResultArea', 'pose': 'poseResultArea' };

        const outId = outputIds[type];
        const areaId = areaIds[type];
        
        if(document.getElementById(areaId)) document.getElementById(areaId).classList.remove('hidden');
        if(document.getElementById(outId)) {
            document.getElementById(outId).innerHTML = "<span class='animate-pulse text-purple-400'>‚ú® Senior Sales Manager is thinking...</span>";
            if(window.innerWidth < 768) setTimeout(() => { document.getElementById(areaId).scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
        }

        // --- FETCH BRAND CONTEXT (Hidden in storage if not on brand tab) ---
        const brandData = JSON.parse(localStorage.getItem('withYouBrandData') || '{}');
        const brandStyle = brandData.brandStyle || "Professional";
        const brandPackages = brandData.brandPackages || "Not specified. Ask client for details.";
        const contactInfo = `Phone: ${brandData.brandPhone || ''}, Viber: ${brandData.brandViber || ''}, Address: ${brandData.brandAddr || ''}`;

        // --- CORE PROMPT SYSTEM ---
        const systemPrompt = `
        ROLE: You are the Senior Sales Manager & Studio Owner of "With You Photo Studio" in Taunggyi.
        YOUR GOAL: Close deals warmly. Be helpful, persuasive, and confident.
        
        TONE RULES (CRITICAL):
        1. Speak Natural Burmese (·Ä°·Äï·Äº·Ä±·Ä¨·ÄÖ·ÄÄ·Ä¨·Ä∏). Use "Bya/Khamya" (male).
        2. Be Empathetic but Sales-Driven. Use the "Sandwich Method" (Value -> Price -> Value).
        3. Never sound like a robot. Use phrases like "·Ä°·ÄÜ·ÄÑ·Ä∫·Äï·Äº·Ä±·Äô·Äö·Ä∫·Äó·Äª", "·ÄÖ·Ä≠·Äê·Ä∫·ÄÅ·Äª·Äï·Ä´", "·Ää·ÄÆ·Äô·Äõ·Ä±/·Ä°·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ·Äõ·Ä±".
        
        STUDIO DATA:
        - Packages: ${brandPackages}
        - Contact: ${contactInfo}
        `;

        let taskPrompt = "";

        if (type === 'dm_best') {
            const service = document.getElementById('dmService').value;
            const scenario = document.getElementById('dmScenario').value;
            const msg = document.getElementById('dmInput').value;
            const strategy = document.getElementById('dmType').value;
            
            taskPrompt = `
            TASK: Write 3 SALES REPLIES for a DM.
            - Context: Client asks about ${service}.
            - Status: ${scenario}.
            - Client Message: "${msg}".
            - Strategy Selected: ${strategy}.
            
            IF Strategy is "Price Defense": Explain WHY it's worth it (Quality, Service, Memories).
            IF Strategy is "Urgency": Mention limited slots for the month.
            IF Strategy is "Value First": List what they get BEFORE mentioning price.
            
            OUTPUT:
            Option 1: [Warm & Detailed Response]
            Option 2: [Short & Punchy Response]
            Option 3: [Question-Based Response to keep convo alive]
            `;
        } 
        else if (type === 'fbpost') {
            const topic = document.getElementById('fbInput').value;
            const tone = document.getElementById('fbTone').value;
            const len = document.getElementById('fbLength').value;
            taskPrompt = `TASK: Write 3 Facebook Post Variations about "${topic}". Tone: ${tone}. Length: ${len}. Include CTA with ${contactInfo}.`;
        }
        else if (type === 'timeline') {
            const start = document.getElementById('tlStart').value;
            const place = document.getElementById('tlPlace').value;
            const dress = document.getElementById('tlDress').value;
            const pace = document.getElementById('tlPace').value;
            const sunset = document.getElementById('tlSunset').checked ? "Include Sunset" : "No Sunset";
            taskPrompt = `TASK: Create Pre-wedding Timeline. Start: ${start}, Place: ${place}, Outfits: ${dress}, Pace: ${pace}, Sunset: ${sunset}. Output: Clear List.`;
        }
        else if (type.includes('tt_')) {
            const topic = document.getElementById('ttInput').value;
            const style = document.getElementById('ttStyle').value;
            const sub = type==='tt_caption'?'Caption':'Script';
            taskPrompt = `TASK: Write 3 TikTok ${sub} options for "${topic}". Style: ${style}. Keep it viral & trendy.`;
        }
        else if (type === 'pose') {
            const input = document.getElementById('poseInput').value;
            const outfit = document.getElementById('poseOutfit').value;
            const props = document.getElementById('poseProps').value;
            taskPrompt = `TASK: Suggest 3 Poses. Context: ${input}. Outfit: ${outfit}. Props: ${props}. Give clear Burmese instructions.`;
        }

        const fullPrompt = systemPrompt + "\n\n" + taskPrompt;

        try {
            const res = await fetch("/api/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: fullPrompt })
            });
            const data = await res.json();
            if(document.getElementById(outId)) {
                document.getElementById(outId).innerText = data.result || "Error generating.";
            }
        } catch(e) {
            console.error(e);
            if(document.getElementById(outId)) document.getElementById(outId).innerText = "Connection Error.";
        }
    }

    // --- VOICE INPUT ---
    function startVoiceInput(elementId, btn) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) { showToast("‚ùå Browser not supported"); return; }
        const recognition = new SpeechRecognition();
        recognition.lang = 'my-MM';
        recognition.interimResults = false;
        
        if(btn) btn.classList.add('listening-ring');
        showToast("üé§ Speaking...");
        
        recognition.start();
        recognition.onresult = (e) => {
            const text = e.results[0][0].transcript;
            const el = document.getElementById(elementId);
            if(el) el.value = el.value ? el.value + " " + text : text;
            showToast("‚úÖ Added!");
        };
        recognition.onend = () => { if(btn) btn.classList.remove('listening-ring'); };
        recognition.onerror = () => { if(btn) btn.classList.remove('listening-ring'); showToast("‚ùå Error"); };
    }

    // --- UTILS ---
    function setDmType(strength, btn) {
        document.getElementById('dmType').value = strength;
        document.querySelectorAll('.tactic-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        showToast("Strategy: " + strength);
    }
    function fillPose(t) { document.getElementById('poseInput').value = t === 'Shy' ? "·Ä°·Äõ·Äô·Ä∫·Ä∏·Äõ·Äæ·ÄÄ·Ä∫·Äê·Äê·Ä∫·Äê·Äö·Ä∫" : "·Äù·Äê·Ä≤·Ä∑·Ä°·Äê·ÄΩ·Ä≤"; }
    function showToast(m) { const t=document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    function copyText(id) { navigator.clipboard.writeText(document.getElementById(id).innerText); showToast("Copied!"); }
    function downloadFile(n, id) { 
        const b = new Blob([document.getElementById(id).innerText],{type:'text/plain'});
        const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download=n; a.click(); 
    }
    function saveResult(t, id) {
        const c = document.getElementById(id).innerText; if(!c) return;
        const h = JSON.parse(localStorage.getItem('studioHistory')||'[]');
        h.unshift({type:t, content:c, date:new Date().toLocaleString()});
        if(h.length>20) h.pop();
        localStorage.setItem('studioHistory', JSON.stringify(h));
        showToast("Saved!");
    }
    function renderHistoryList() {
        const l = JSON.parse(localStorage.getItem('studioHistory')||'[]');
        const c = document.getElementById('historyListContainer');
        c.innerHTML = l.length ? l.map(i=>`<div class="glass-panel p-4 rounded-lg border-l-4 border-blue-500 mb-2"><div class="flex justify-between text-xs text-slate-400 mb-1"><span class="font-bold text-white bg-slate-700 px-2 rounded">${i.type}</span><span>${i.date}</span></div><div class="text-sm text-slate-300 line-clamp-3">${i.content}</div><button onclick="navigator.clipboard.writeText(\`${i.content.replace(/`/g,'')}\`);showToast('Copied')" class="text-blue-400 text-xs mt-2">Copy</button></div>`).join('') : "<div class='text-center text-slate-500'>No history yet</div>";
    }
    function clearHistory() { if(confirm("Clear?")) { localStorage.removeItem('studioHistory'); renderHistoryList(); } }
    async function runAssistant(type) { /* Short logic reusing generateAI core or simpler prompt */ }
  </script>
</body>
</html>
