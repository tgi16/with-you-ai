<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>With You Studio - Sales Master AI v4.1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
  <!-- Phosphor Icons -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body { font-family: 'Padauk', sans-serif; }
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    
    .glass-panel {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }
    
    .nav-item.active, .mobile-nav-item.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tactic-btn.active, .creative-btn.active {
        background-color: #7e22ce; 
        border-color: #a855f7;
        color: white;
        font-weight: bold;
        box-shadow: 0 0 15px rgba(168, 85, 247, 0.5);
    }

    #sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .sidebar-open { transform: translateX(0) !important; }
    .sidebar-closed { transform: translateX(-100%); }
    @media (min-width: 768px) { .sidebar-closed { transform: translateX(0); } }

    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    .listening-ring {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        animation: pulse-red 1.5s infinite cubic-bezier(0.66, 0, 0, 1);
        border-color: #ef4444 !important; color: #ef4444 !important;
    }
    @keyframes pulse-red { to { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }
    
    /* Toast Animation */
    .toast { visibility: hidden; min-width: 250px; background-color: #1e293b; color: #fff; text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 14px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; opacity: 0; }
    .toast.show { visibility: visible; bottom: 40px; opacity: 1; }
  </style>
</head>
<body class="bg-slate-950 text-slate-200 h-screen h-[100dvh] flex overflow-hidden selection:bg-blue-500/30">

  <!-- LOGIN OVERLAY -->
  <div id="loginOverlay" class="fixed inset-0 z-[60] bg-slate-950/95 backdrop-blur-sm flex flex-col items-center justify-center p-6 transition-opacity duration-300">
    <div class="glass-panel p-8 rounded-3xl w-full max-w-sm border border-slate-700/50 shadow-2xl flex flex-col items-center space-y-6">
        <div class="text-center">
            <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-500/20 rotate-3">
                <i class="ph ph-camera text-4xl text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-white tracking-tight">With You Studio</h2>
            <p class="text-sm text-slate-400 mt-1 font-medium">Sales & Content AI</p>
        </div>
        
        <div class="w-full space-y-4">
            <div class="space-y-1">
                <label class="text-xs font-bold text-slate-400 uppercase ml-1">Email</label>
                <div class="relative group">
                    <i class="ph ph-envelope absolute left-3 top-3.5 text-slate-500 text-lg group-focus-within:text-blue-400 transition"></i>
                    <input type="email" id="loginEmail" placeholder="admin@studio.com" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 pl-10 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition placeholder-slate-600">
                </div>
            </div>
            <div class="space-y-1">
                <label class="text-xs font-bold text-slate-400 uppercase ml-1">Password</label>
                <div class="relative group">
                    <i class="ph ph-key absolute left-3 top-3.5 text-slate-500 text-lg group-focus-within:text-blue-400 transition"></i>
                    <input type="password" id="loginPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-3 pl-10 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500/50 outline-none transition placeholder-slate-600">
                </div>
            </div>
            <button onclick="window.handleLogin()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-blue-600/20 transition active:scale-95 flex justify-center gap-2 items-center mt-2">
                <span>Sign In</span>
                <i class="ph ph-arrow-right-bold"></i>
            </button>
        </div>
        
        <p id="loginError" class="text-red-400 text-xs text-center hidden bg-red-900/20 p-3 rounded-lg w-full border border-red-900/30 flex items-center justify-center gap-2">
            <i class="ph ph-warning-circle"></i> <span id="loginErrorText">Error</span>
        </p>
    </div>
  </div>

  <!-- OVERLAY for Mobile Sidebar -->
  <div id="overlay" onclick="window.toggleSidebar()" class="fixed inset-0 bg-black/60 z-40 hidden md:hidden backdrop-blur-sm transition-all"></div>

  <!-- SIDEBAR NAVIGATION -->
  <aside id="sidebar" class="sidebar-closed fixed inset-y-0 left-0 z-50 w-72 bg-slate-900/95 border-r border-slate-800 flex flex-col transition-transform duration-300 md:relative md:translate-x-0 shadow-2xl backdrop-blur-xl">
    <div class="p-6 border-b border-slate-800/50 flex items-center justify-between bg-slate-900/50">
        <div>
            <h1 class="text-xl font-bold text-white tracking-tight flex items-center gap-2">
                <span class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white"><i class="ph ph-camera-fill"></i></span>
                With You
            </h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest mt-1.5 flex items-center gap-1.5 pl-1">
                <span id="connectionStatus" class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span> Offline
            </p>
        </div>
        <button onclick="window.toggleSidebar()" class="md:hidden text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-800 transition"><i class="ph ph-x text-xl"></i></button>
    </div>

    <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-8 custom-scroll">
        <div>
            <p class="px-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-3">Core Strategy</p>
            <div class="space-y-1">
                <button onclick="window.loadView('creative')" id="nav-creative" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-lightbulb text-xl text-yellow-400 group-hover:scale-110 transition"></i> Ideas
                </button>
                <button onclick="window.loadView('dm')" id="nav-dm" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-chat-circle-text text-xl text-purple-400 group-hover:scale-110 transition"></i> Sales DM
                </button>
                <button onclick="window.loadView('brand')" id="nav-brand" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-brain text-xl text-blue-400 group-hover:scale-110 transition"></i> Brand Brain
                </button>
            </div>
        </div>
        <div>
            <p class="px-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-3">Content</p>
            <div class="space-y-1">
                <button onclick="window.loadView('fbpost')" id="nav-fbpost" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-facebook-logo text-xl text-blue-500 group-hover:scale-110 transition"></i> Facebook
                </button>
                <button onclick="window.loadView('tiktok')" id="nav-tiktok" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-tiktok-logo text-xl text-teal-400 group-hover:scale-110 transition"></i> TikTok
                </button>
            </div>
        </div>
        <div>
            <p class="px-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-3">Tools</p>
            <div class="space-y-1">
                <button onclick="window.loadView('timeline')" id="nav-timeline" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-clock text-xl text-orange-400 group-hover:scale-110 transition"></i> Timeline
                </button>
                <button onclick="window.loadView('pose')" id="nav-pose" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group">
                    <i class="ph ph-camera text-xl text-pink-400 group-hover:scale-110 transition"></i> Pose
                </button>
                <button onclick="window.loadView('recent')" id="nav-recent" class="nav-item w-full flex items-center gap-3 px-3 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800/80 hover:text-white transition group relative">
                    <i class="ph ph-clock-counter-clockwise text-xl text-green-400 group-hover:scale-110 transition"></i> 
                    History
                    <span id="recentBadge" class="hidden absolute right-3 top-4 w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                </button>
            </div>
        </div>
    </nav>

    <div class="p-4 border-t border-slate-800/50 bg-slate-900/50">
        <div id="userEmailDisplay" class="text-[10px] text-slate-500 mb-3 truncate text-center font-mono bg-slate-950/50 py-1 rounded">...</div>
        <button onclick="window.handleLogout()" class="w-full py-2.5 border border-red-500/20 bg-red-500/5 rounded-xl text-red-400 hover:bg-red-500/10 hover:border-red-500/30 transition flex items-center justify-center gap-2 text-xs font-bold">
            <i class="ph ph-sign-out text-lg"></i> Sign Out
        </button>
    </div>
  </aside>

  <!-- MAIN CONTENT AREA (RIGHT) -->
  <div class="flex-1 flex flex-col h-full relative w-full bg-slate-950">
    <header class="md:hidden h-16 bg-slate-900/80 border-b border-slate-800 flex items-center justify-between px-4 z-30 shrink-0 backdrop-blur-md sticky top-0">
        <button onclick="window.toggleSidebar()" class="text-white p-2 hover:bg-slate-800 rounded-lg transition"><i class="ph ph-list text-2xl"></i></button>
        <span class="font-bold text-white text-lg tracking-tight">With You Studio</span>
        <div class="w-10"></div>
    </header>

    <!-- MOBILE QUICK NAV -->
    <div class="md:hidden bg-slate-950/95 border-b border-slate-800 overflow-x-auto no-scrollbar py-3 px-4 flex gap-3 shrink-0 backdrop-blur-md z-20">
        <button onclick="window.loadView('creative')" id="mob-creative" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-900">
            <i class="ph ph-lightbulb text-yellow-400"></i> Ideas
        </button>
        <button onclick="window.loadView('dm')" id="mob-dm" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-900">
            <i class="ph ph-chat-circle-text text-purple-400"></i> DM
        </button>
        <button onclick="window.loadView('fbpost')" id="mob-fbpost" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-900">
            <i class="ph ph-facebook-logo"></i> Post
        </button>
        <button onclick="window.loadView('tiktok')" id="mob-tiktok" class="mobile-nav-item flex items-center gap-2 px-4 py-2 rounded-full border border-slate-700 text-xs font-bold text-slate-300 whitespace-nowrap bg-slate-900">
            <i class="ph ph-tiktok-logo"></i> TikTok
        </button>
    </div>

    <!-- Dynamic Content Container -->
    <div id="content-container" class="flex-1 overflow-y-auto p-4 md:p-8 max-w-5xl mx-auto w-full pb-24 scroll-smooth">
        <!-- Content injects here via JS -->
    </div>
  </div>

  <div id="toast" class="toast"></div> <!-- Content will be set by JS -->

  <!-- TEMPLATES -->
  
  <!-- 0. CREATIVE DIRECTOR TEMPLATE -->
  <template id="tpl-creative">
    <div class="animate-fade-in space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-xl md:text-3xl font-bold text-yellow-400 flex items-center gap-3"><i class="ph ph-lightbulb"></i> Creative Director</h2>
            <div class="text-[10px] text-slate-400 bg-slate-800/50 border border-slate-700 px-3 py-1 rounded-full">Idea Gen</div>
        </div>
        
        <div class="glass-panel p-6 rounded-2xl border border-yellow-500/20 shadow-xl relative overflow-hidden">
            <i class="ph ph-sparkle absolute -top-4 -right-4 text-[10rem] text-yellow-500 opacity-5 rotate-12"></i>
            
            <p class="text-sm text-slate-300 mb-6 relative z-10 max-w-lg leading-relaxed">
                "·Äí·ÄÆ·Äî·Ä±·Ä∑ ·Äò·Ä¨·Äê·ÄÑ·Ä∫·Äõ·Äô·Äú·Ä≤?" ·Äú·Ä≠·ÄØ·Ä∑ ·ÄÖ·Äâ·Ä∫·Ä∏·ÄÖ·Ä¨·Ä∏·Äõ·ÄÅ·ÄÄ·Ä∫·Äî·Ä±·Äú·Ä¨·Ä∏·Åã ·ÄÄ·Ä≠·ÄØ·ÄÖ·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Äõ·Ä≤·Ä∑ Brand Brain ·ÄÄ·Ä≠·ÄØ·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄÆ·Ä∏ ·ÅÉ ·Äõ·ÄÄ·Ä∫·ÄÖ·Ä¨ Plan ·ÄÜ·ÄΩ·Ä≤·Äï·Ä±·Ä∏·Äï·Ä´·Äô·Äö·Ä∫·Åã
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10">
                <!-- Inputs -->
                <div class="space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Today's Workload</label>
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="setCreativeOption('workload', 'Busy', this)" class="creative-btn p-3 rounded-xl border border-slate-600 bg-slate-800/50 hover:bg-slate-700 text-xs font-bold text-center transition">Busy<br><span class="text-lg">ü•µ</span></button>
                            <button onclick="setCreativeOption('workload', 'Normal', this)" class="creative-btn active p-3 rounded-xl border border-slate-600 bg-slate-800/50 hover:bg-slate-700 text-xs font-bold text-center transition">Normal<br><span class="text-lg">üòê</span></button>
                            <button onclick="setCreativeOption('workload', 'Free', this)" class="creative-btn p-3 rounded-xl border border-slate-600 bg-slate-800/50 hover:bg-slate-700 text-xs font-bold text-center transition">Motivated<br><span class="text-lg">ü§©</span></button>
                        </div>
                        <input type="hidden" id="crWorkload" value="Normal">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Focus Area</label>
                        <div class="relative">
                            <i class="ph ph-target absolute left-3 top-3.5 text-slate-500"></i>
                            <select id="crFocus" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-3 pl-10 text-sm text-white focus:border-yellow-500 outline-none appearance-none">
                                <option value="Anything">üé≤ Anything (Best Choice)</option>
                                <option value="Pre-Wedding">üíç Pre-Wedding Focus</option>
                                <option value="Wedding Day">üë∞ Wedding Day</option>
                                <option value="Studio Branding">üè¢ Studio Branding</option>
                                <option value="Family Portrait">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family / Portrait</option>
                            </select>
                            <i class="ph ph-caret-down absolute right-3 top-3.5 text-slate-500 pointer-events-none"></i>
                        </div>
                    </div>

                    <div class="pt-2">
                         <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Platforms</label>
                         <div class="flex gap-4">
                             <label class="flex items-center gap-2 cursor-pointer bg-slate-800/50 px-4 py-2 rounded-lg border border-slate-700 hover:border-blue-500 transition select-none">
                                 <input type="checkbox" id="crFB" checked class="w-4 h-4 rounded bg-slate-700 border-slate-600 text-blue-500 focus:ring-0">
                                 <span class="text-sm text-slate-300 font-bold">Facebook</span>
                             </label>
                             <label class="flex items-center gap-2 cursor-pointer bg-slate-800/50 px-4 py-2 rounded-lg border border-slate-700 hover:border-teal-500 transition select-none">
                                 <input type="checkbox" id="crTT" checked class="w-4 h-4 rounded bg-slate-700 border-slate-600 text-teal-500 focus:ring-0">
                                 <span class="text-sm text-slate-300 font-bold">TikTok</span>
                             </label>
                         </div>
                    </div>

                    <button onclick="window.generateAI('creative_director')" class="w-full mt-4 bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-yellow-900/30 transition active:scale-95 flex items-center justify-center gap-2">
                        <i class="ph ph-magic-wand text-xl"></i> Create Plan
                    </button>
                </div>

                <!-- Output Area -->
                <div id="crResultArea" class="hidden md:block h-full">
                     <div class="bg-slate-950/40 rounded-xl border border-slate-700 p-5 h-full flex flex-col shadow-inner">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs font-bold text-yellow-400 uppercase flex items-center gap-2"><i class="ph ph-calendar-blank"></i> 3-Day Plan</span>
                            <button onclick="window.copyText('crOutput')" class="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded-lg border border-slate-600 text-white transition">Copy</button>
                        </div>
                        <div id="crOutput" class="whitespace-pre-wrap text-sm text-slate-200 leading-relaxed flex-1 overflow-y-auto max-h-[400px] custom-scroll pr-2"></div>
                     </div>
                </div>
            </div>
            
            <!-- Mobile Output -->
            <div id="crResultAreaMobile" class="md:hidden hidden mt-6">
                <div class="bg-slate-950/40 rounded-xl border border-slate-700 p-5 shadow-inner">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs font-bold text-yellow-400 uppercase">Your Plan</span>
                        <button onclick="window.copyText('crOutputMobile')" class="text-xs bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-600 text-white">Copy</button>
                    </div>
                    <div id="crOutputMobile" class="whitespace-pre-wrap text-sm text-slate-200 leading-relaxed"></div>
                </div>
            </div>

        </div>
    </div>
  </template>

  <!-- 1. DM SALES MASTER TEMPLATE -->
  <template id="tpl-dm">
    <div class="animate-fade-in space-y-6">
        <div class="flex items-center justify-between">
            <h2 class="text-xl md:text-3xl font-bold text-purple-400 flex items-center gap-3"><i class="ph ph-chat-circle-text"></i> DM Sales Master</h2>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div class="glass-panel p-6 rounded-2xl space-y-5 border border-purple-500/20 shadow-lg shadow-purple-900/5">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Topic</label>
                            <div class="relative">
                                <select id="dmService" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-3 text-sm text-white focus:border-purple-500 outline-none appearance-none">
                                    <option value="Pre-wedding Package">üíç Pre-wedding</option>
                                    <option value="Wedding Actual Day">üë∞ Wedding Day</option>
                                    <option value="Family Photoshoot">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</option>
                                    <option value="Graduation Photo">üéì Graduation</option>
                                    <option value="General Inquiry">‚ùì General</option>
                                </select>
                                <i class="ph ph-caret-down absolute right-3 top-3.5 text-slate-500 pointer-events-none"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Status</label>
                            <div class="relative">
                                <select id="dmScenario" class="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-3 text-sm text-white focus:border-purple-500 outline-none appearance-none">
                                    <option value="New Inquiry">New Inquiry</option>
                                    <option value="Price Objection">Expensive (·Äà·Ä±·Ä∏·ÄÄ·Äº·ÄÆ·Ä∏)</option>
                                    <option value="Ghosting">Seen (·ÄÖ·Ä¨·Äô·Äï·Äº·Äî·Ä∫)</option>
                                    <option value="Comparing">Comparing (·Äö·Äæ·Äâ·Ä∫·Äî·Ä±)</option>
                                    <option value="Closing">Ready to Book</option>
                                </select>
                                <i class="ph ph-caret-down absolute right-3 top-3.5 text-slate-500 pointer-events-none"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-2 tracking-wider">Client Message</label>
                        <div class="relative">
                            <textarea id="dmInput" placeholder="Client ·Äô·Ä±·Ä∏·Äê·Ä≤·Ä∑·ÄÖ·Ä¨ (·Äû·Ä≠·ÄØ·Ä∑) ·Ä°·ÄÅ·Äº·Ä±·Ä°·Äî·Ä±..." class="w-full bg-slate-800/50 border border-slate-600 rounded-xl p-4 text-sm h-32 text-white resize-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500/50 pr-12 shadow-inner"></textarea>
                            <button onclick="window.startVoiceInput('dmInput', this)" class="absolute right-3 bottom-3 bg-slate-700/80 hover:bg-purple-600 p-2.5 rounded-full transition text-slate-300 hover:text-white shadow-lg" title="Speak"><i class="ph ph-microphone text-xl"></i></button>
                        </div>
                    </div>

                    <button onclick="window.generateAI('dm_analyze')" class="w-full bg-slate-800 hover:bg-slate-700 text-indigo-300 font-bold py-3 rounded-xl shadow border border-indigo-500/30 transition active:scale-95 flex items-center justify-center gap-2">
                        <i class="ph ph-magnifying-glass text-lg"></i> Analyze Client Status
                    </button>
                    
                    <div id="dmAnalysisPanel" class="hidden animate-fade-in bg-slate-950/60 p-4 rounded-xl border border-indigo-500/30 relative mt-2">
                        <div class="absolute -top-3 left-4 bg-slate-900 px-3 text-[10px] text-indigo-400 uppercase font-bold tracking-wider border border-indigo-500/30 rounded-full">Analysis</div>
                        <div id="dmAnalysisContent" class="space-y-3 text-sm mt-2 text-slate-300"></div>
                    </div>

                    <div class="pt-4 border-t border-slate-800/50">
                        <label class="block text-[10px] font-bold text-slate-500 uppercase mb-3 tracking-wider">Manual Strategy Override</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="window.setDmType('Price Defense', this)" class="tactic-btn p-3 border border-slate-600/50 rounded-xl bg-slate-800/50 hover:bg-slate-700 text-xs text-left transition flex items-center gap-3"><i class="ph ph-shield-check text-xl text-green-400"></i> Price Defense</button>
                            <button onclick="window.setDmType('Urgency', this)" class="tactic-btn p-3 border border-slate-600/50 rounded-xl bg-slate-800/50 hover:bg-slate-700 text-xs text-left transition flex items-center gap-3"><i class="ph ph-timer text-xl text-orange-400"></i> Create Urgency</button>
                        </div>
                        <input type="hidden" id="dmType" value="Soft Close">
                    </div>
                    
                    <button onclick="window.generateAI('dm_best')" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-xl shadow-purple-900/40 transition active:scale-95 flex items-center justify-center gap-2">
                        <i class="ph ph-magic-wand text-xl"></i> Generate 3 Replies
                    </button>
                </div>
            </div>

            <!-- Right Column: Output -->
            <div id="dmResultArea" class="hidden h-full">
                <div class="glass-panel p-6 rounded-2xl border-purple-500/30 h-full flex flex-col relative overflow-hidden shadow-2xl">
                    <div class="absolute top-0 right-0 p-6 opacity-5 pointer-events-none"><i class="ph ph-robot text-8xl text-purple-500"></i></div>
                    
                    <div class="flex justify-between items-center mb-4 z-10">
                        <span class="text-xs font-bold text-purple-400 uppercase flex items-center gap-2"><i class="ph ph-check-circle-fill"></i> Generated Options</span>
                        <button onclick="window.copyText('dmOutput')" class="text-xs bg-purple-500/20 hover:bg-purple-500/40 px-3 py-1.5 rounded-lg text-purple-200 border border-purple-500/30 transition">Copy All</button>
                    </div>
                    
                    <div id="dmOutput" class="whitespace-pre-wrap text-sm text-slate-200 leading-relaxed flex-1 overflow-y-auto max-h-[600px] z-10 pr-2 custom-scroll bg-slate-950/30 p-4 rounded-xl border border-white/5"></div>
                    
                    <button id="dmContinueBtn" onclick="window.continueAI('dm_best')" class="hidden w-full mt-4 py-3 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-xl text-purple-300 text-sm font-bold flex items-center justify-center gap-2 transition active:scale-95 shadow-lg">
                        <span>‚ö†Ô∏è Continue Writing</span>
                        <i class="ph ph-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
  </template>

  <!-- 2. BRAND BRAIN TEMPLATE -->
  <template id="tpl-brand">
    <div class="animate-fade-in max-w-2xl mx-auto space-y-6">
        <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-8 rounded-3xl border border-slate-700 relative overflow-hidden shadow-2xl">
            <h2 class="text-xl md:text-3xl font-bold text-white mb-2 flex items-center gap-3"><i class="ph ph-database text-blue-400"></i> Studio Brain</h2>
            <p class="text-sm text-slate-400 mb-8 ml-1">Teaching AI your business. Data is synced to the cloud.</p>
            
            <div class="space-y-6 text-left relative z-10">
                <div class="bg-slate-950/50 p-5 rounded-2xl border border-slate-700">
                    <label class="text-xs font-bold text-yellow-400 uppercase mb-3 block flex items-center gap-2"><i class="ph ph-package"></i> Packages & Pricing</label>
                    <textarea id="brandPackages" placeholder="Example: Silver Package: 3 Lakhs..." class="w-full bg-slate-900 border border-slate-600 rounded-xl p-4 text-sm text-white h-32 resize-none focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500/50"></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label class="text-xs font-bold text-blue-400 uppercase mb-2 block">Studio Vibe</label>
                        <input type="text" id="brandStyle" value="Moody, Cinematic, Emotional" class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-blue-400 uppercase mb-2 block">Target Audience</label>
                        <input type="text" id="brandClient" value="Luxury Couples, Young Professionals" class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white">
                    </div>
                </div>
                
                <div class="pt-4">
                    <button onclick="window.saveBrandData()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition active:scale-95"><i class="ph ph-floppy-disk text-xl"></i> Save Changes</button>
                    <div id="saveStatus" class="text-xs text-slate-500 text-center mt-2">Sync ready.</div>
                </div>
            </div>
        </div>
    </div>
  </template>

  <!-- Other Templates (FB, Timeline, Recent - using similar polished style) -->
  <template id="tpl-fbpost">
     <div class="animate-fade-in space-y-6">
        <h2 class="text-xl md:text-2xl font-bold text-white flex items-center gap-2"><i class="ph ph-facebook-logo text-blue-500"></i> Facebook Post</h2>
        <div class="glass-panel p-6 rounded-2xl space-y-5">
            <div>
                <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Topic</label>
                <div class="flex gap-2">
                    <input type="text" id="fbInput" class="flex-1 bg-slate-800 border border-slate-600 rounded-xl p-3 text-white" placeholder="Topic...">
                    <button onclick="window.startVoiceInput('fbInput', this)" class="bg-slate-800 border border-slate-600 rounded-xl px-4 hover:bg-slate-700 text-blue-400"><i class="ph ph-microphone text-xl"></i></button>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <select id="fbTone" class="bg-slate-800 border border-slate-600 rounded-xl p-3 text-white"><option>Professional</option><option>Friendly</option><option>Emotional</option></select>
                <select id="fbLength" class="bg-slate-800 border border-slate-600 rounded-xl p-3 text-white"><option>Medium</option><option>Long</option><option>Short</option></select>
            </div>
            <button onclick="window.generateAI('fbpost')" class="w-full bg-blue-600 hover:bg-blue-500 py-3.5 rounded-xl font-bold text-white shadow-lg active:scale-95 transition">Write Post</button>
        </div>
        <div id="fbResultArea" class="hidden glass-panel p-6 rounded-2xl">
            <div id="fbOutput" class="whitespace-pre-wrap text-sm text-slate-200"></div>
            <button id="fbContinueBtn" onclick="window.continueAI('fbpost')" class="hidden w-full mt-4 py-3 bg-slate-800 rounded-xl text-blue-400 text-sm font-bold border border-slate-600">‚ö†Ô∏è Continue</button>
            <button onclick="window.copyText('fbOutput')" class="w-full mt-2 py-3 border border-slate-600 rounded-xl text-slate-300 hover:bg-slate-800 text-sm">Copy</button>
        </div>
     </div>
  </template>

  <!-- JS Logic same as before but ensured robustness -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyBEqE5lWdLWIZOO_M3RYY35e17VMTGk-G0", authDomain: "saiai-content-generator.firebaseapp.com", projectId: "saiai-content-generator", storageBucket: "saiai-content-generator.firebasestorage.app", messagingSenderId: "574947512372", appId: "1:574947512372:web:1d35a5b5aa6f24ea493a61", measurementId: "G-C2Q8Y2XBMD" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = 'with-you-studio-v4';
    let userId = null;

    const getValue = (id) => { const el = document.getElementById(id); return el ? el.value : ""; };
    
    // Auth
    window.handleLogin = async () => {
        try { await signInWithEmailAndPassword(auth, getValue('loginEmail'), getValue('loginPass')); } 
        catch(e) { const err = document.getElementById('loginError'); err.classList.remove('hidden'); document.getElementById('loginErrorText').innerText = e.message; }
    };
    window.handleLogout = async () => { await signOut(auth); window.location.reload(); };

    onAuthStateChanged(auth, (user) => {
        const overlay = document.getElementById('loginOverlay');
        if (user) {
            userId = user.uid;
            document.getElementById('connectionStatus').classList.replace('bg-red-500', 'bg-green-500');
            document.getElementById('userEmailDisplay').innerText = user.email;
            overlay.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => overlay.classList.add('hidden'), 300);
            if(window.currentView === 'brand') loadBrandData();
        } else {
            userId = null;
            overlay.classList.remove('hidden');
            setTimeout(() => overlay.classList.remove('opacity-0', 'pointer-events-none'), 50);
        }
    });

    // View Routing
    window.currentView = 'dm';
    window.loadView = (viewId) => {
        window.currentView = viewId;
        // Sidebar active state
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navBtn = document.getElementById('nav-' + viewId);
        if(navBtn) navBtn.classList.add('active');
        
        // Mobile active state
        document.querySelectorAll('.mobile-nav-item').forEach(el => {
             el.classList.remove('bg-slate-800', 'text-white', 'border-blue-500');
             el.classList.add('bg-slate-900', 'text-slate-300', 'border-slate-700');
        });
        const mobBtn = document.getElementById('mob-' + viewId);
        if(mobBtn) {
            mobBtn.classList.remove('bg-slate-900', 'text-slate-300', 'border-slate-700');
            mobBtn.classList.add('bg-slate-800', 'text-white', 'border-blue-500');
            mobBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }

        // Close sidebar on mobile
        if(window.innerWidth < 768) window.toggleSidebar();

        const container = document.getElementById('content-container');
        const tpl = document.getElementById('tpl-' + viewId);
        if(tpl) {
            container.innerHTML = '';
            container.appendChild(tpl.content.cloneNode(true));
            if(viewId === 'brand') loadBrandData();
        }
    };

    window.toggleSidebar = () => {
        const sb = document.getElementById('sidebar');
        const ov = document.getElementById('overlay');
        sb.classList.toggle('sidebar-closed'); sb.classList.toggle('sidebar-open');
        ov.classList.toggle('hidden');
    };

    // Brand Data
    window.saveBrandData = async () => {
        if(!userId) return window.showToast("Login First");
        const status = document.getElementById('saveStatus');
        status.innerText = "Saving...";
        const data = {};
        ['brandStyle','brandClient','brandPhone','brandViber','brandFB','brandTT','brandAddr','brandPackages'].forEach(id => {
            const el = document.getElementById(id); if(el) data[id] = el.value;
        });
        try {
            await setDoc(doc(db, 'artifacts', appId, 'users', userId, 'config', 'brand'), data, {merge: true});
            status.innerText = "Saved ‚úÖ"; status.classList.add('text-green-400');
            window.showToast("Saved to Cloud");
        } catch(e) { status.innerText = "Error"; }
    };

    window.loadBrandData = async () => {
        if(!userId) return;
        try {
            const snap = await getDoc(doc(db, 'artifacts', appId, 'users', userId, 'config', 'brand'));
            if(snap.exists()) {
                const d = snap.data();
                Object.keys(d).forEach(k => { const el = document.getElementById(k); if(el) el.value = d[k]; });
            }
        } catch(e) { console.error(e); }
    };

    // AI Generation
    window.generateAI = async (type, isContinue = false) => {
        const outId = type.includes('fb') ? 'fbOutput' : type.includes('dm') ? 'dmOutput' : type.includes('creative') ? 'crOutput' : 'tlOutput';
        const resArea = type.includes('fb') ? 'fbResultArea' : type.includes('dm') ? 'dmResultArea' : type.includes('creative') ? 'crResultArea' : 'tlResultArea';
        const contBtn = type.includes('fb') ? 'fbContinueBtn' : type.includes('dm') ? 'dmContinueBtn' : null;

        if(type !== 'dm_analyze') {
            document.getElementById(resArea).classList.remove('hidden');
            if(!isContinue) {
                document.getElementById(outId).innerHTML = "<span class='animate-pulse text-purple-400'>‚ú® Thinking...</span>";
                if(window.innerWidth < 768) {
                    // Mobile scroll logic
                     if(type === 'creative_director') document.getElementById('crResultAreaMobile').classList.remove('hidden');
                     setTimeout(() => document.getElementById(resArea).scrollIntoView({behavior:'smooth'}), 100);
                }
            }
        } else {
            document.getElementById('dmAnalysisPanel').classList.remove('hidden');
            document.getElementById('dmAnalysisContent').innerHTML = "<span class='animate-pulse text-indigo-400'>üîç Analyzing...</span>";
        }

        // Fetch brand data
        let brand = {};
        if(userId) { try { const s = await getDoc(doc(db, 'artifacts', appId, 'users', userId, 'config', 'brand')); if(s.exists()) brand = s.data(); } catch(e){} }
        const packages = brand.brandPackages || "Not set";
        const contact = `Ph: ${brand.brandPhone||''}, Viber: ${brand.brandViber||''}, FB: ${brand.brandFB||''}`;

        // Construct Prompt
        const baseSystem = `Role: Owner of With You Studio, Taunggyi. Tone: Natural Burmese (Bya/Khamya), Warm, Professional. Data: ${packages}, ${contact}. IMPORTANT: Write COMPLETE text.`;
        
        let prompt = "";
        if(type === 'dm_best') {
             prompt = `Task: Write 3 Distinct Sales Replies. Client: "${getValue('dmInput')}". Context: ${getValue('dmService')}. Strategy: ${getValue('dmType')}. Format: Option 1, 2, 3.`;
             if(isContinue) prompt = `Context: Continue writing DM replies from: "${document.getElementById(outId).innerText.slice(-50)}". Finish it.`;
        } else if(type === 'fbpost') {
             prompt = `Task: Write 3 FB Post Variations. Topic: ${getValue('fbInput')}. Tone: ${getValue('fbTone')}. Length: ${getValue('fbLength')}.`;
             if(isContinue) prompt = `Context: Continue FB post from: "${document.getElementById(outId).innerText.slice(-50)}". Finish it with CTA & Hashtags.`;
        } else if(type === 'creative_director') {
             prompt = `Task: 3-Day Content Plan. Workload: ${getValue('crWorkload')}. Focus: ${getValue('crFocus')}.`;
        }

        try {
            const res = await fetch("/api/generate", {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: baseSystem + "\n\n" + prompt })
            });
            const d = await res.json();
            
            if(type === 'dm_analyze') {
                // Analysis handler
                const html = `<div class='text-slate-300'>${d.result.replace(/\n/g, '<br>')}</div>`;
                document.getElementById('dmAnalysisContent').innerHTML = html;
            } else {
                if(isContinue) document.getElementById(outId).innerText += "\n" + d.result;
                else document.getElementById(outId).innerText = d.result;
                
                // Duplicate for mobile creative
                if(type === 'creative_director') document.getElementById('crOutputMobile').innerText = d.result;
                
                if(contBtn) document.getElementById(contBtn).classList.remove('hidden');
            }
        } catch(e) { console.error(e); }
    };

    window.continueAI = (t) => window.generateAI(t, true);

    // Helpers
    window.showToast = (m) => { const t = document.getElementById('toast'); t.innerText = m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); };
    window.copyText = (id) => { navigator.clipboard.writeText(document.getElementById(id).innerText); window.showToast("Copied"); };
    window.setDmType = (t, b) => { document.getElementById('dmType').value = t; document.querySelectorAll('.tactic-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
    window.setCreativeOption = (t, v, b) => { document.getElementById('crWorkload').value = v; document.querySelectorAll('.creative-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
    window.startVoiceInput = (id, btn) => {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!SR) return window.showToast("No Voice Support");
        const r = new SR(); r.lang = 'my-MM'; r.start();
        btn.classList.add('listening-ring');
        r.onresult = (e) => { document.getElementById(id).value += " " + e.results[0][0].transcript; window.showToast("Heard!"); };
        r.onend = () => btn.classList.remove('listening-ring');
    };

    // Init
    window.loadView('dm');
  </script>
</body>
</html>
